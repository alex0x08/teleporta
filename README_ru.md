# Телепорта
Телепортируем файлы с 2015го года. Публичная версия.

Утилита для быстрой, надежной, удобной и безопасной передачи файлов
между любыми компьютерами в любой сети.

Передача файлов в действии:
![In short](https://github.com/alex0x08/teleporta/blob/main/images/316/teleporta-demo.gif?raw=true)
На ролике выше показана передача файла с компьютера Bob на компьютер Alice и в обратную сторону.

Все действие происходит в фоне, взаимодействие с пользователем сведено к копированию файла в каталог отправки.

Передача буфера обмена:
![Clipboard](https://github.com/alex0x08/teleporta/blob/main/images/316/teleporta-clipboard-demo.gif?raw=true)

Передача буфера обмена между компьютером Alice и компьютером Bob.

Все действие также происходит в фоне, взаимодействие с пользователем сводится к нажатию 
комбинации клавиш копирования в буфер обмена (Ctrl-C) на первом и вставки (Ctrl-V) на втором
компьютере.

# Как это работает
Телепорта это консольное приложение с двумя режимами работы: клиент (портал) и сервер (релей).

В самом простом случае для передачи файлов между компьютерами, необходимо запустить Телепорту на одном, скопировать
полученную ссылку и использовать ее на другом компьютере для подключения.

Для передачи файла, его необходимо скопировать в локальный каталог, который Телепорта *магическим образом* связывает 
с другим компьютером.

Как только скопированный файл исчезнет - ожидайте его появления на другом компьютере. 
Если файл не исчезает, значит телепорт сломался: сеть или релей недоступны.

Ссылка на каталоги для передачи появится на рабочем столе при запуске.

Схема работы:
![Schema](https://github.com/alex0x08/teleporta/blob/main/images/teleporta-schema.png?raw=true)

В режиме релея, Телепорта начинает работать как узел для пересылки файлов: запускается встроенный HTTP-сервер,
который принимает входящие запросы.
С версии 3.1.6 режим релея включается по-умолчанию.

После этого, другая копия Телепорты, но уже в режиме "портала" подключается к этому релею
и использует его для передачи файлов на другие порталы.

![Relay mode](https://github.com/alex0x08/teleporta/blob/main/images/316/teleporta-default.png?raw=true)

В режиме портала, Телепорта подключается к релею с помощью специальной ссылки и регистрируется на нем,
чтобы быть доступным для других порталов.

После регистрации, приложение получает список других порталов с релея и создает
локальные каталоги, с именами совпадающими с именами порталов.

Затем включает мониторинг изменений в них:
каждый файл или каталог, обнаруженный в каталоге отправки, связанном с конкретным удаленным порталом,
будет телепортирован в этот портал.


![Portal mode](https://github.com/alex0x08/teleporta/blob/main/images/316/teleporta-connected-to-relay.png?raw=true)


# Как запустить

Скачайте последнюю версию файла `teleporta.cmd` из раздела Releases и запустите.
Для большинства случаев этого будет достаточно.

# Java
Телепорта использует Java для своей работы, если она у вас не установлена - ее будет необходимо установить.
Подойдет любая версия начиная с 1.8, будет работать как JRE, так и JDK.

Для Windows старше 10 есть поддержка автоматического скачивания JRE. 

Телепорта использует особую "магию" для универсального запуска, поэтому один и тот же
файл является исполняемым для Windows, Linux, BSD, MacOS и всех остальных операционных систем где есть Java.

Может случиться, что магии окажется недостаточно, в этом случае Телепорту 
всегда можно запустить как самое обычное Java-приложение:

```
java -jar teleporta.cmd
```
Обязательно сообщите нам, что "колдунство не сработало" и мы добавим больше магии для вашего случая.

Для запуска в режиме релея просто запустите Телепорту:
```
teleporta.cmd
```
Сразу после запуска появится длинная строка подключения:

`http://majestic12:8989/2d52fb71ef728d8813a001a6592c8248801d844ce2c0d0a6976f10b73d3bdb463ea4cd09c1ad9a25d5b83a543238`

Эту строку необходимо скопировать и использовать в качестве аргумента при запуске Телепорты в режиме портала уже на другом компьютере:

```
teleporta.cmd http://majestic12:8989/2d52fb71ef728d8813a001a6592c8248801d844ce2c0d0a6976f10b73d3bdb463ea4cd09c1ad9a25d5b83a543238
```

Начиная с версии 3.1.6, релей по-умолчанию также запускает встроенный портал, поэтому может принимать и отправлять файлы самостоятельно.

Для отключения этой опции, используйте указанный параметр при запуске релея:
```
-DrelayHasPortal=false
```

Заметим, что встроенный портал запускается только для релея "по-умолчанию", без дополнительных настроек.

Также возможно запустить полноценный релей и портал на одной и той же машине, что часто используется для тестирования:

![Both Portal and relay on same machine](https://github.com/alex0x08/teleporta/blob/main/images/teleporta-both.png?raw=true)

Стоит помнить, что запущенный "по-умолчанию" встроенный портал будет иметь название, совпадающее с именем компьютера,
поэтому для запуска локально другой копии портала необходимо указать для него другое название: 
```
-DportalName="My another portal"
```

# В работе

![Sample 1](https://github.com/alex0x08/teleporta/blob/main/images/screen1.gif?raw=true)
![Sample 2](https://github.com/alex0x08/teleporta/blob/main/images/screen2.gif?raw=true)
![Sample 3](https://github.com/alex0x08/teleporta/blob/main/images/screen3.gif?raw=true)

FreeBSD:
![Sample 4](https://github.com/alex0x08/teleporta/blob/main/images/inaction/teleporta-freebsd.jpg?raw=true)


# Криптография

Каждый портал имеет свою пару ключей (публичный и приватный), которые используются для шифрования и дешифровки файлов.
Публичный ключ портала передается релею при регистрации, релей раздает этот ключ всем остальным порталам.

Если портал "Вася" хочет отправить файл в портал "Маша", он зашифрует передаваемый файл публичным ключом "Маши".
При получении файла, портал "Маша" расшифровывает файл с помощью своего приватного ключа.

Таким образом релей не имеет возможности расшифровки передаваемых файлов, поэтому может быть публичным.

Публичная версия использует ослабленные алгоритмы: 2048-битный RSA и 128-битный AES, достаточные для
обычных пользователей, но не являющиеся препятствием для любой серьезной организации, поэтому не стоит использовать утилиту 
для каких-либо незаконных действий.

# Дополнительные опции

У Телепорты есть множество опций, включаемых или отключаемых через
стандартный для Java механизм параметров окружения: `-Dключ=значение`

Также возможно задавать параметры в конфигурационном файле  `teleporta.properties`, 
но без префикса `-D` :
```
appDebug=true
clipboard=true
relayUrl=http://majestic12:8989/testseed
```

Ниже описание каждой доступной опции.

Включение отладочных сообщений:
```
-DappDebug=true
```
Включить *программный* мониторинг изменений в каталогах вместо стандартного:
```
-DdumbWatcher=true
```
Актуально для медленных, устаревших или сетевых файловых систем.
Например, для показанного выше запуска на Windows 98 использовалась именно такая реализация. 

Использовать статический `seed`:
```
-Dseed=testseed
```
Если эта опция включена, стартовый URL (context path) для подключения будет совпадать
с предоставленным `seed`: `http://majestic12:8989/testseed`

Разрешить релею обновлять уже зарегистрированные порталы:
```
-DallowPortalNameUpdate=true
```
Актуально для отладки, поскольку без этой опции повторное подключение к релею с совпадающим именем
станет невозможным до момента истечения сессии.

Использовать указанное название портала:
```
-DportalName=samplePortal
```
По-умолчанию используется название компьютера (hostname).

Использовать шаблон имени портала:
```
-DportalNameTemplate="USERNAME from HOSTNAME"
```
Ключевые слова USERNAME и HOSTNAME будут заменены на имя пользователя и название компьютера,
финальная строка будет использоваться в качестве названия.

Не показывать лого при запуске:
```
-DshowLogo=false
```

Указать сообщение, отображаемое релем при подключении портала:
```
-Dmotd="This is my awesome relay!"
```

Не создавать ссылку на рабочем столе при запуске:  
```
-DcreateDesktopLink=false
```

Указать родительский каталог, в котором работает Телепорта:
```
-DappHome=/full/path/to/folder
```
Работает как для релея, так и для портала.


Указать порт прослушивания:
```
-DappPort=9000
```
По-умолчанию будет выбран случайный порт из доступных.

Удалять недоставленные файлы при запуске:
```
-DclearOutgoing=true
```
Работает как на стороне релея, так и на стороне портала.
При включении, все недоставленные (не скачанные - для релея) файлы будут удалены при запуске.

Отключено по умолчанию, поэтому Телепорта будет пытаться доставить файлы.

Полностью отключить возможность отправки файлов с портала:
```
-DallowOutgoing=false
```

Если эта опция задана, Телепорта не будет создавать исходящий каталог и мониторить изменения.

Актуально для серверов, которые должны лишь получать входящие файлы, но не отправлять.

# Приватный релей

С версии 3.1.1 мы добавили опцию *приватный релей*, которая позволяет запускать релей
в приватном режиме: 

порталы не смогут подключиться к такому релею без наличия локального файла
с его (релея) публичным ключем. 

Для включения укажите аргумент `-DprivateRelay=true` при запуске релея, 
затем скопируйте и сохраните в файл публичный ключ, который будет показан в консоли:
```
|TELEPORTA30820122300d06092a864886f70d01010105000382010f003082010a0282010100b04b
a71d7f0a7ce1dc9359a8e90c63971904105d443303a171e6622c8ba14121aba9e09a748293b31a65
076dda3d58237783978a8c490a714516607aca2f68577e59b707bd53b4dcfe26ed7221769081d76f
3af7b5554eb3a6f2e653a5092109a35f963d52fdf23b6978f3e273cbf95f716d12e13db380cd9688
340cc3cd00ca61a730b38e7ecbed0436bf7e86d6eee75c89515f730ad7001d41ebc42ba7b0d46a58
2d3215be71cbbd246b52f7f0c12c642c00d16b1e3617326c0c24b15057aa4c89fb345af4c54fe4a3
954750164291a2d2c8c0aa10f86db1935722d1ec80104dc139b4fe1810d678e5a2ca8af2368c4452
be458a6606eca8331386ef625e050203010001|
``` 

Затем укажите путь к файлу с сохраненным ключем при запуске Телепорты в режиме портала:
```
-DrelayKey=/opt/work/tmp/tele.pub
```


# Скачивание сборки

С версии 3.1.2 была добавлена очень важная опция, сильно упрощающая развертывание: 

Релей позволяет скачать копию Телепорты с заранее заданной настройкой подключения к самому себе.

Просто откройте ссылку в браузере с компьютера, где собираетесь запустить портал - скачается архив
с приложением и конфигурационным файлом, в котором будет задана ссылка для подключения к этому релею:

```
 Public Teleporta Relay started: http://amarok:8989/4d9575d00ace270aa168c8d043a99984c0ba4807043719b4629461f31cf828d30645
```
Все что нужно будет сделать это распаковать и запустить приложение.

Опция включена по-умолчанию, для отключения:
```
-DselfDownload=false
```


# Ручная отправка и 'lock' файл

Попытка копирования очень большого каталога с большой же вложенностью, может приводить к некорректным 
результатам, когда триггер Телепорты сработает до того как каталог будет полностью скопирован.

Если у вас есть подозрения, что отправленные данные неполны - стоит попробовать режим *ручной отправки*:
```
-DuseLockFile=true
```
При включении, любое копирование файла или каталога в каталог отправки больше не будет
немедленно запускать пересылку. Вместо этого, будет создаваться файл *lock* и пока он присутствует - отправка не запустится.

Логика следующая: 

1) пользователь копирует данные в каталог отправки, 
2) убеждается что данные скопированы и все процессы копирования завершены,
3) удаляет файл *lock*, что запускает процесс отправки.


# Локализация
Начиная с версии 3.1.6 у Телепорты появилась локализация, в данный момент поддерживаются английский и русский.
По-умолчанию будет использоваться системная локаль, из вызова `Locale.getDefault()` 

Также возможно переопределение локали, с помощью указания параметра: `-Dlang=ru` - для русского
или `-Dlang=en` - для английского.

# Сборка

Телепорта не имеет каких-либо зависимостей и легко собирается любым JDK версии 1.8 и выше, с помощью
стандартного Apache Maven, из любой среды разработки:
```
mvn clean package
```
Результат сборки в виде запускаемого файла `teleporta.cmd` будет находиться в каталоге `target`.


